<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Roblox Western FPS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;overflow:hidden;background:#000;font-family:sans-serif}

/* UI */
#ui{position:fixed;top:10px;left:10px;z-index:10;color:white}
#ui div{background:rgba(0,0,0,.5);padding:6px 10px;border-radius:6px;margin-bottom:6px}
#crosshair{
  position:fixed;top:50%;left:50%;
  width:20px;height:20px;
  margin-left:-10px;margin-top:-10px;
  border:2px solid white;
  border-radius:50%;
  display:none;z-index:9;
}

/* ë²„íŠ¼ */
button{
  position:fixed;right:20px;
  padding:12px;border:none;
  border-radius:12px;font-size:18px;
  z-index:10
}
#shoot{bottom:20px}
#reloadBtn{bottom:80px}
#view{bottom:140px}
#aim{bottom:200px}
</style>
</head>
<body>

<div id="ui">
  <div id="hp">â¤ï¸ 100</div>
  <div id="ammo">ğŸ”« 6 / 6</div>
</div>

<div id="crosshair"></div>

<button id="shoot">ğŸ”«</button>
<button id="reloadBtn">ğŸ”„</button>
<button id="view">ğŸ‘</button>
<button id="aim">ğŸ¯</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

<script>
/* ===== THREE ê¸°ë³¸ ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xcfa46a);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,300);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(30,50,20);
scene.add(sun);

const ground=new THREE.Mesh(
  new THREE.PlaneGeometry(300,300),
  new THREE.MeshStandardMaterial({color:0xc2a46d})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

/* ===== í”Œë ˆì´ì–´ ===== */
const player=new THREE.Group();
scene.add(player);

const torso=new THREE.Mesh(
  new THREE.BoxGeometry(1.8,2.2,1),
  new THREE.MeshStandardMaterial({color:0x8b5a2b})
);
torso.position.y=2.2;
player.add(torso);

/* ===== ë¦¬ë³¼ë²„ ===== */
const gun=new THREE.Mesh(
  new THREE.BoxGeometry(1,0.3,0.3),
  new THREE.MeshStandardMaterial({color:0x222})
);
gun.position.set(1.4,2.2,0.4);
player.add(gun);

/* ===== ìƒíƒœ ===== */
let ammo=6,maxAmmo=6;
let third=true;
let aiming=false;
const ammoUI=document.getElementById("ammo");
const crosshair=document.getElementById("crosshair");

/* ===== ì‚¬ìš´ë“œ (ê±°ë¦¬ê°) ===== */
const listener=new THREE.AudioListener();
camera.add(listener);
const gunSound=new THREE.PositionalAudio(listener);
new THREE.AudioLoader().load(
  "https://cdn.pixabay.com/audio/2022/03/15/audio_92c6b43f8f.mp3",
  buffer=>{
    gunSound.setBuffer(buffer);
    gunSound.setRefDistance(10);
  }
);
gun.add(gunSound);

/* ===== ë°œì‚¬ ===== */
function shoot(){
  if(ammo<=0) return;
  ammo--;
  ammoUI.innerText=`ğŸ”« ${ammo} / ${maxAmmo}`;
  gunSound.play();
}

/* ===== ì¡°ì¤€ ===== */
document.getElementById("aim").onclick=()=>{
  aiming=!aiming;
  crosshair.style.display=aiming?"block":"none";
  camera.fov=aiming?40:70;
  camera.updateProjectionMatrix();
};

/* ===== ì´ë™ (ì™¼ìª½ í™”ë©´ ì „ìš©) ===== */
let moveX=0,moveZ=0;
document.addEventListener("touchstart",e=>{
  if(e.touches[0].clientX<innerWidth/2){
    moveX=e.touches[0].clientX;
    moveZ=e.touches[0].clientY;
  }
});
document.addEventListener("touchmove",e=>{
  if(e.touches[0].clientX<innerWidth/2){
    player.position.x+=(e.touches[0].clientX-moveX)*0.002;
    player.position.z+=(e.touches[0].clientY-moveZ)*0.002;
    moveX=e.touches[0].clientX;
    moveZ=e.touches[0].clientY;
  }
});

/* ===== ë£¨í”„ ===== */
function animate(){
  requestAnimationFrame(animate);

  camera.position.lerp(
    third
      ? new THREE.Vector3(player.position.x,6,player.position.z+8)
      : new THREE.Vector3(player.position.x,4.2,player.position.z+0.2),
    0.15
  );
  camera.lookAt(player.position.x,2.5,player.position.z);

  renderer.render(scene,camera);
}
animate();

document.getElementById("shoot").onclick=shoot;
document.getElementById("view").onclick=()=>third=!third;
document.getElementById("reloadBtn").onclick=()=>{ammo=maxAmmo;ammoUI.innerText=`ğŸ”« ${ammo} / ${maxAmmo}`};
</script>
</body>
</html>