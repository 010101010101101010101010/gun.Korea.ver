<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mobile FPS FIXED</title>

<style>
html,body{
  margin:0;
  overflow:hidden;
  background:#000;
  touch-action:none;
}
canvas{display:block}

/* 조준점 */
#cross{
  position:fixed;
  left:50%; top:50%;
  width:18px; height:18px;
  margin:-9px;
  pointer-events:none;
}
#cross:before,#cross:after{
  content:""; position:absolute; background:#fff;
}
#cross:before{width:18px;height:2px;top:8px}
#cross:after{width:2px;height:18px;left:8px}

/* 조이스틱 */
#joystick{
  position:fixed;
  left:20px; bottom:20px;
  width:120px; height:120px;
  border-radius:50%;
  background:rgba(255,255,255,0.15);
}
#stick{
  position:absolute;
  left:40px; top:40px;
  width:40px; height:40px;
  border-radius:50%;
  background:rgba(255,255,255,0.6);
}

/* 발사 버튼 */
#fire{
  position:fixed;
  right:20px; bottom:40px;
  width:90px; height:90px;
  border-radius:50%;
  background:red;
  opacity:0.6;
}
</style>
</head>

<body>
<canvas id="c"></canvas>

<div id="cross"></div>
<div id="joystick"><div id="stick"></div></div>
<div id="fire"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ======================
   BASIC
====================== */
const renderer = new THREE.WebGLRenderer({canvas:c});
renderer.setSize(innerWidth, innerHeight);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(
  75, innerWidth/innerHeight, 0.1, 1000
);

/* 빛 */
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const sun = new THREE.DirectionalLight(0xffffff, 0.6);
sun.position.set(5,10,5);
scene.add(sun);

/* ======================
   MAP
====================== */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(500,500),
  new THREE.MeshStandardMaterial({color:0x4caf50})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

/* ======================
   PLAYER (로블록스 비율)
====================== */
const player = new THREE.Group();

const body = new THREE.Mesh(
  new THREE.BoxGeometry(1,1.6,0.6),
  new THREE.MeshStandardMaterial({color:0x2196f3})
);
body.position.y = 0.8;

player.add(body);
player.position.set(0,0,5);
scene.add(player);

/* ======================
   CONTROLS
====================== */
let yaw = 0, pitch = 0;
let moveX = 0, moveY = 0;

/* 조이스틱 */
const joy = document.getElementById("joystick");
const stick = document.getElementById("stick");

joy.addEventListener("touchmove", e=>{
  const t = e.touches[0];
  const r = joy.getBoundingClientRect();
  const dx = t.clientX - (r.left + r.width/2);
  const dy = t.clientY - (r.top + r.height/2);

  moveX = Math.max(-1, Math.min(1, dx/40));
  moveY = Math.max(-1, Math.min(1, dy/40));

  stick.style.transform =
    `translate(${moveX*30}px, ${moveY*30}px)`;
});
joy.addEventListener("touchend", ()=>{
  moveX = moveY = 0;
  stick.style.transform = "translate(0,0)";
});

/* 화면 회전 (오른쪽만) */
let lastX = 0, lastY = 0;
document.addEventListener("touchstart", e=>{
  lastX = e.touches[0].clientX;
  lastY = e.touches[0].clientY;
});
document.addEventListener("touchmove", e=>{
  if(e.touches[0].clientX < innerWidth/2) return;

  const dx = e.touches[0].clientX - lastX;
  const dy = e.touches[0].clientY - lastY;
  lastX = e.touches[0].clientX;
  lastY = e.touches[0].clientY;

  yaw -= dx * 0.005;
  pitch -= dy * 0.005;
  pitch = Math.max(-1.2, Math.min(1.2, pitch));
});

/* ======================
   LOOP
====================== */
function loop(){
  requestAnimationFrame(loop);

  /* 이동 */
  const speed = 0.12;
  player.position.x +=
    (Math.sin(yaw)*moveY + Math.cos(yaw)*moveX) * speed;
  player.position.z +=
    (Math.cos(yaw)*moveY - Math.sin(yaw)*moveX) * speed;

  /* 카메라 */
  camera.position.set(
    player.position.x,
    player.position.y + 1.4,
    player.position.z
  );
  camera.rotation.set(pitch, yaw, 0);

  renderer.render(scene, camera);
}
loop();
</script>
</body>
</html>